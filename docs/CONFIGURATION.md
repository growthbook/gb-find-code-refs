# Configuring gb-find-code-refs

`gb-find-code-refs` may be configured using [command line flags](#command-line), [environment variables](#environment-variables), or a [YAML file](#yaml).

If options are defined multiple times across configuration methods, they will be used with the following priority:

flags > env > yaml

In addition, [ignore files](#ignoring-files-and-directories) may be defined to improve performance and exclude files and directories from being scanned by `gb-find-code-refs`.

## Required arguments

The following arguments are required to run `gb-find-code-refs`. For a detailed description of all options, see the [command line arguments](#command-line)

| Option      | Description                                                                                                      |
| ----------- | ---------------------------------------------------------------------------------------------------------------- |
| `dir`       | Path to existing checkout of the git repo. The currently checked out branch will be scanned for code references. |
| `flagsPath` | Path to JSON file containing feature flag keys. Format should be an array of strings.                            |

## Command line

<!-- These docs should be autogenerated: https://github.com/spf13/cobra/blob/master/doc/md_docs.md -->

Usage:

```
gb-find-code-refs [flags]
```

Flags:

```
      --allowTags                  Enables parsing references for tags.

  -b, --branch string              The currently checked out branch. If not provided, branch name will be auto-detected. Provide this option when using CI systems that leave the repository in a detached HEAD state.

  -C, --contextLines int           The number of context lines to include with each code reference. If 0, only the lines containing flag references will be sent. If > 0, will include that number of context lines above and below the flag reference. A maximum of 5 context lines may be provided. (default 2)

      --debug                      Enables verbose debug logging

  -d, --dir string                 Path to existing checkout of the repository.

  -f, --flagsPath string           Required path to a JSON file containing a list of flag keys (array of strings). The scanner will search for references to the flags in this file.

  -h, --help                       help for gb-find-code-refs

  -i, --ignoreServiceErrors        If enabled, the scanner will terminate with exit code 0 when the LaunchDarkly API is unreachable or returns an unexpected response.

  -l, --lookback int               Sets the number of git commits to search in history for whether a feature flag was removed from code. May be set to 0 to disabled this feature. Setting this option to a high value will increase search time. (default 10)

  -o, --outDir string              If provided, will output the JSON file containing all code references to this directory. Otherwise, will output JSON file to current working directory.

  -R, --revision string            Use this option to scan non-git codebases. The current revision of the repository to be scanned. If set, the version string for the scanned repository will not be inferred. The "branch" option is required when "revision" is set.

  -v, --version                    version for gb-find-code-refs
```

## Environment variables

All command line flags are available as environment variables following the "upper snake case" format, with a prefix of `GB_`. For example, the command line option `flagsPath` may be set as an environment variable e.g. `export GB_FLAGS_PATH = '../../project-dir'`.

## YAML

A YAML file may be used to specify most command line arguments, as well as a number of additional options for advanced usage of `gb-find-code-refs`. The configuration YAML file should be stored as `${dir}/.growthbook/coderefs.yaml`.

Command line options translate directly to keys in your YAML file. For example, the following options in [this example](EXAMPLES.md#context-lines) can be specified in YAML as follows:

```yaml
outDir: "./output"
contextLines: 3
```

### YAML Restrictions

`flagsPath` and `dir` may not be specified in the YAML file, and must be specified as either command line flags or environment variables.

### Advanced YAML configuration

In addition to all command line options, the `coderefs.yaml` file allows you to configure Code Reference Aliases, Projects, and custom flag key delimiters.

#### Aliases

Patterns to match aliases for your flag keys may be defined to better suit your implementation of LaunchDarkly. See [ALIASES.md](ALIASES.md) for more information.

#### Projects

Supported Version: 2.5.0+

Projects allow Code References to scan a monorepo for multiple LaunchDarkly Projects in a single run. If a `dir` is provided Code References will only start looking for that Project's feature flag keys and aliases below that directory.

Each Project block can support an optional list of alias configuration blocks. Any globally defined aliases will be inherited.

_Upgrading note from a version prior to 2.5.0_: Previous versions of `gb-find-code-refs` required `projKey` parameter to be set. If you want to use 'projects' in your configuration (typically used for monorepos) you will need to remove the `projKey` parameter.

```yaml
projects:
    - key: example-project
      dir: subdir/to/start
      aliases:
          - type: camelcase
```

#### Delimiters

By default, `gb-find-code-refs` will only match flag keys surrounded by single quotes ('), double quotes ("), or backticks (`). This default behavior may be disabled and additional delimiters may be defined to better suit your implementation of LaunchDarkly.

The following example disables delimiters, and instructs `gb-find-code-refs` to only match flag keys surrounded by carets (< and >)

```yaml
delimiters:
    disableDefaults: true # boolean. if enabled, only `additional` delimiters will be used.
    additional: # an array of single-character strings
        - "<"
        - ">"
```

## Ignoring files and directories

All dotfiles and patterns in `.gitignore` and `.ignore` will be excluded by default.

To ignore additional files and directories, provide a `.gbignore` file in the root directory of your Git repository. All patterns specified in `.gbignore` file will be excluded by the scanner. Patterns must follow the `.gitignore` format as specified here: https://git-scm.com/docs/gitignore#_pattern_format
